<div class="dashboard-container">
  <aside class="sidebar">
    <div class="logo-area">
      <img src="img/logo-senseflow.png" alt="SenseFlow Logo" class="logo-image">
      <span class="logo-text">SenseFlow</span>
    </div>

       <nav class="main-nav">
        <button class="nav-item" [class.active]="active==='home'" (click)="active='home'; redirectToContent()">
          <span class="material-symbols-outlined">home</span> Início
        </button>

        <button class="nav-item" [class.active]="active==='reports'" (click)="active='reports'; redirectToEvents()">
          <span class="material-symbols-outlined">bar_chart</span> Relatórios
        </button>

        <button class="nav-item" [class.active]="active==='settings'" (click)="active='settings'; redirectToSettings()">
          <span class="material-symbols-outlined">settings</span> Configurações
        </button>
    </nav>
  </aside>

  <main class="content-area">
    <header class="header-toolbar">
      <div class="user-profile">
        <span *ngIf="(userDetails$ | async) as user">Olá, {{user.Username}}!</span>
      </div>
      <button class="logout-button" (click)="logout()">
        <span class="material-symbols-outlined">logout</span>
        Sair
      </button>
    </header>

    <section class="page-content">
      <div class="card profile-main-card">
        <div class="card-header">
          <h3 class="card-title">Perfil do Usuário</h3>
        </div>
        <div class="card-body">
          <div class="profile-section">
            <div class="profile-avatar-container">
              <div class="profile-avatar-circle">
                <span class="material-symbols-outlined">person</span>
              </div>
            </div>
            
            <div class="profile-info" *ngIf="(userDetails$ | async) as user">
              <h4 class="profile-name">{{user.Username}}</h4>
              <p class="profile-role">Administrador(a) do Sistema</p>

              <div class="profile-details-grid">
                <div class="profile-detail-item">
                  <span class="material-symbols-outlined">mail</span>
                  <div>
                    <span class="detail-label">E-mail Cadastrado</span>
                    <span class="detail-value">
                      {{user.Email}}
                      <span class="verified-badge">
                        <span class="material-symbols-outlined">verified</span>
                      </span>
                    </span>
                  </div>
                </div>

                <div class="profile-detail-item">
                  <span class="material-symbols-outlined">lock</span>
                  <div>
                    <span class="detail-label">Senha</span>
                    <span class="detail-value password-field">
                      <span class="password-dots">••••••••</span>
                      <button class="change-password-btn" (click)="openPasswordModal()">Alterar</button>
                    </span>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de Alteração de Senha -->
      <div class="modal-overlay" *ngIf="showPasswordModal" [class.active]="showPasswordModal" (click)="closePasswordModal()"></div>
      <div class="password-modal" *ngIf="showPasswordModal" [class.active]="showPasswordModal">
        <div class="modal-header">
          <h3>Alterar Senha</h3>
          <button class="modal-close" (click)="closePasswordModal()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="current-password">Senha Atual</label>
            <input type="password" id="current-password" [(ngModel)]="currentPassword" placeholder="Digite sua senha atual" required>
          </div>
          <div class="form-group">
            <label for="new-password">Nova Senha</label>
            <input type="password" id="new-password" [(ngModel)]="newPassword" placeholder="Digite a nova senha" required>
          </div>
          <div class="form-group">
            <label for="confirm-password">Confirmar Nova Senha</label>
            <input type="password" id="confirm-password" [(ngModel)]="confirmPassword" placeholder="Confirme a nova senha" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-button cancel" (click)="closePasswordModal()">Cancelar</button>
          <button class="modal-button confirm" (click)="confirmPasswordChange()">Confirmar</button>
        </div>
      </div>

      <!-- Modal de Confirmação de Exclusão de Conta -->
      <div class="modal-overlay" *ngIf="showDeleteModal" [class.active]="showDeleteModal" (click)="closeDeleteModal()"></div>
      <div class="confirmation-modal delete-modal" *ngIf="showDeleteModal" [class.active]="showDeleteModal">
        <div class="modal-header modal-header-danger">
          <div class="header-content">
            <span class="material-symbols-outlined header-icon">error</span>
            <div>
              <h3>Confirmação de Exclusão</h3>
              <p class="header-subtitle">Esta ação não pode ser desfeita</p>
            </div>
          </div>
          <button class="modal-close" (click)="closeDeleteModal()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="critical-action-banner-danger">
            <span class="material-symbols-outlined">warning</span>
            <span>AÇÃO CRÍTICA</span>
          </div>
          <p class="modal-description">Você está prestes a excluir permanentemente sua conta do sistema SenseFlow.</p>
          <div class="info-box">
            <h4>Consequências desta ação:</h4>
            <ul class="consequence-list">
              <li>
                <span class="material-symbols-outlined">database</span>
                <span>Todos os dados e configurações serão removidos</span>
              </li>
              <li>
                <span class="material-symbols-outlined">history</span>
                <span>Histórico completo de eventos será apagado</span>
              </li>
              <li>
                <span class="material-symbols-outlined">analytics</span>
                <span>Relatórios e estatísticas não poderão ser recuperados</span>
              </li>
              <li>
                <span class="material-symbols-outlined">block</span>
                <span>O acesso ao sistema será permanentemente revogado</span>
              </li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" (click)="closeDeleteModal()">
            Cancelar
          </button>
          <button class="btn-danger" (click)="confirmDeleteAccount()">
            <span class="material-symbols-outlined">delete_forever</span>
            Confirmar Exclusão
          </button>
        </div>
      </div>

      <!-- Modal de Confirmação de Reset de Registros -->
      <div class="modal-overlay" *ngIf="showResetModal" [class.active]="showResetModal" (click)="closeResetModal()"></div>
      <div class="confirmation-modal reset-modal" *ngIf="showResetModal" [class.active]="showResetModal">
        <div class="modal-header modal-header-warning">
          <div class="header-content">
            <span class="material-symbols-outlined header-icon">notification_important</span>
            <div>
              <h3>Confirmação de Reset</h3>
              <p class="header-subtitle">Limpeza completa de registros</p>
            </div>
          </div>
          <button class="modal-close" (click)="closeResetModal()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="warning-banner warning">
            <span class="material-symbols-outlined">info</span>
            <span>Operação de Manutenção - Requer Confirmação</span>
          </div>
          <p class="modal-description">Esta operação irá remover permanentemente todos os registros de eventos do sistema.</p>
          <div class="info-box">
            <h4>Dados que serão removidos:</h4>
            <ul class="consequence-list">
              <li>
                <span class="material-symbols-outlined">event</span>
                <span>Todos os eventos registrados no sistema</span>
              </li>
              <li>
                <span class="material-symbols-outlined">schedule</span>
                <span>Histórico completo de entradas e saídas</span>
              </li>
              <li>
                <span class="material-symbols-outlined">calendar_month</span>
                <span>Dados de data e horário de todos os registros</span>
              </li>
            </ul>
          </div>
          <p class="note-text"><strong>Nota:</strong> Sua conta e configurações permanecerão intactas.</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" (click)="closeResetModal()">
            Cancelar
          </button>
          <button class="btn-warning" (click)="confirmResetEvents()">
            <span class="material-symbols-outlined">delete_sweep</span>
            Confirmar Reset
          </button>
        </div>
      </div>

      <div class="settings-grid">
        <div class="card settings-card">
          <div class="card-header">
            <h3 class="card-title">
              <span class="material-symbols-outlined">tune</span>
              Configurações do Sistema
            </h3>
          </div>
          <div class="card-body">
            <div class="setting-item">
              <div class="setting-label">
                <span class="material-symbols-outlined">restart_alt</span>
                <div>
                  <label>Resetar Registros</label>
                  <p class="setting-description">Limpar todos os dados</p>
                </div>
              </div>
              <button (click)="onResetEvents()" class="reset-button">
                <span class="material-symbols-outlined">delete_sweep</span>
                Resetar
              </button>
            </div>

            <div class="setting-item">
              <div class="setting-label">
                <span class="material-symbols-outlined">dark_mode</span>
                <div>
                  <label>Modo Noturno</label>
                  <p class="setting-description">Tema escuro para os olhos</p>
                </div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [checked]="darkMode$ | async" (change)="toggleDarkMode()">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="card help-card">
          <div class="card-header">
            <h3 class="card-title">
              <span class="material-symbols-outlined">support_agent</span>
              Ajuda e Suporte
            </h3>
          </div>
          <div class="card-body">
            <a (click)="redirectToHelp()" class="help-option" style="cursor: pointer;">
              <span class="material-symbols-outlined">help_center</span>
              <div>
                <strong>Central de Ajuda</strong>
                <p>Guias e tutoriais</p>
              </div>
              <span class="material-symbols-outlined arrow">arrow_forward</span>
            </a>

            <a (click)="contactSupport()" class="help-option" style="cursor: pointer;">
              <span class="material-symbols-outlined">contact_support</span>
              <div>
                <strong>Contatar Suporte</strong>
                <p>Envie uma mensagem</p>
              </div>
              <span class="material-symbols-outlined arrow">arrow_forward</span>
            </a>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="action-button primary" (click)="exportReport()">
          <span class="material-symbols-outlined">download</span>
          Exportar Relatório
        </button>
        <button class="action-button danger-outline" (click)="deleteAccount()">
          <span class="material-symbols-outlined">delete</span>
          Excluir Conta
        </button>
      </div>
    </section>
  </main>
</div>